<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Fruit Cut ‚Äî Transparent Fruits + Smooth Build</title>
<style>
  :root{ --btn:#111; --btnHover:#333; --accent:#22c55e; }
  body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial,Helvetica;margin:12px;background:#f4f7fb;color:#111}
  .container{max-width:980px;margin:0 auto}
  h1{margin:6px 0 10px}
  .hud{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:8px}
  .stat{background:#fff;padding:8px 12px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,0.04);display:flex;align-items:center}
  #gameWrapper{
    position:relative;height:520px;border-radius:12px;overflow:hidden;
    border:1px solid rgba(0,0,0,0.06);
    background-color:#e9e6e1;background-size:cover;background-position:center center;background-repeat:no-repeat;
  }

  /* transparent fruit styles */
  .fruit{
    position:absolute;
    width:auto;
    height:auto;
    border-radius:0;
    overflow:visible;
    display:block;
    transform-origin:center center;
    z-index:600;
    will-change:transform;
    -webkit-backface-visibility:hidden;
    backface-visibility:hidden;
  }
  img.fruit-img{
    display:block;
    width:auto;
    height:auto;
    object-fit:contain;
    background:transparent;
    pointer-events:none;
    -webkit-transform:translateZ(0);
    transform:translateZ(0);
  }

  #gameArea{position:absolute;inset:0;touch-action:none;overflow:visible}
  canvas#splatCanvas{position:absolute;inset:0;z-index:50;pointer-events:none}
  canvas#bladeCanvas{position:absolute;inset:0;z-index:900;pointer-events:none}
  .controls{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap}
  button{padding:8px 12px;border-radius:8px;border:0;background:var(--btn);color:#fff;cursor:pointer;font-weight:600;box-shadow:0 6px 12px rgba(2,6,23,0.06)}
  button:hover{background:var(--btnHover)}
  .ghost{background:#fff;color:#111;border:1px solid #e6e6e6;box-shadow:none;padding:8px 12px;border-radius:8px}
  .scorePop{position:absolute;right:12px;top:12px;background:#fff;padding:6px 10px;border-radius:8px;display:none;z-index:1100;box-shadow:0 10px 30px rgba(2,6,23,0.08)}
  .comboBadge{position:absolute;left:50%;top:12px;transform:translateX(-50%);background:rgba(255,200,60,0.98);padding:8px 14px;border-radius:999px;font-weight:700;display:none;z-index:1100;box-shadow:0 8px 20px rgba(0,0,0,0.12)}
  #bigStart{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:200;background:rgba(0,0,0,0.85);color:#fff;padding:18px 28px;border-radius:12px;font-size:20px;cursor:pointer;box-shadow:0 10px 30px rgba(0,0,0,0.25)}
  .debugBox{position:fixed;right:12px;top:12px;z-index:99999;background:rgba(0,0,0,0.8);color:#fff;padding:8px;max-width:38%;font-size:12px;border-radius:8px;line-height:1.25;max-height:60vh;overflow:auto;display:none}
  @media (max-width:700px){ #gameWrapper{height:420px} .debugBox{max-width:90%;left:6px;right:6px} }
  *{-webkit-tap-highlight-color:transparent!important;user-select:none!important}
</style>
</head>
<body>
<div class="container">
  <h1>üçâ Fruit Cut ‚Äî Transparent Fruits + Offline Save</h1>

  <div class="hud">
    <div class="stat">Score: <strong id="scoreEl">0</strong></div>
    <div class="stat">Lives: <strong id="livesEl">3</strong></div>
    <div class="stat">Coins: <strong id="coinsEl">0</strong></div>
    <div style="flex:1"></div>
    <div class="stat">Level: <strong id="levelEl">1</strong></div>
  </div>

  <div id="gameWrapper">
    <div id="gameArea"></div>
    <canvas id="splatCanvas"></canvas>
    <canvas id="bladeCanvas"></canvas>
    <div class="scorePop" id="coinPop">+0</div>
    <div class="comboBadge" id="comboBadge">COMBO x2!</div>
    <div id="bigStart">START</div>
  </div>

  <div class="controls">
    <button id="startBtn" class="ghost">Start</button>
    <button id="pauseBtn" class="ghost" disabled>Pause</button>
    <button id="restartBtn" class="ghost">Restart</button>
  </div>

  <p style="color:#666;margin-top:12px">Transparent PNG fruits supported. Swipe to cut fruits ‚Äî smooth animation & offline save.</p>
</div>

<div id="debug" class="debugBox"></div>

<script src="https://cdn.jsdelivr.net/npm/eruda"></script>
<script>eruda.init();</script>

<script>
(function(){
  const gameArea=document.getElementById("gameArea"),
        bladeCanvas=document.getElementById("bladeCanvas"),
        splatCanvas=document.getElementById("splatCanvas"),
        scoreEl=document.getElementById("scoreEl"),
        livesEl=document.getElementById("livesEl"),
        coinsEl=document.getElementById("coinsEl"),
        levelEl=document.getElementById("levelEl"),
        startBtn=document.getElementById("startBtn"),
        pauseBtn=document.getElementById("pauseBtn"),
        restartBtn=document.getElementById("restartBtn"),
        coinPop=document.getElementById("coinPop"),
        comboBadge=document.getElementById("comboBadge"),
        bigStart=document.getElementById("bigStart");
  const DBG=document.getElementById("debug");function dlog(m){console.log("[FruitCut]",m);if(window.innerWidth>700){DBG.style.display='block';const el=document.createElement('div');el.textContent=m;DBG.appendChild(el);if(DBG.childElementCount>50)DBG.removeChild(DBG.firstChild);}}
  const IMAGES=["apple.png","banana.png","mango.png","orange.png","watermelon.png","strawberry.png","pineapple.png","papaya.png","pomegranate.png"];
  const BOMB="bomb.png";const CACHE={};const active=[];let running=false,score=0,coins=0,lives=3,level=1;
  const GRAVITY=0.25,MAX_ACTIVE=5,SPAWN_BASE=1000;let spawnTimer;
  const bladeCtx=bladeCanvas.getContext("2d");const splatCtx=splatCanvas.getContext("2d");
  let areaW=480,areaH=520;function resizeAll(){const r=gameArea.getBoundingClientRect();areaW=r.width;areaH=r.height;bladeCanvas.width=areaW;bladeCanvas.height=areaH;splatCanvas.width=areaW;splatCanvas.height=areaH;}window.addEventListener("resize",resizeAll);setTimeout(resizeAll,80);
  async function preload(){await Promise.all(IMAGES.concat([BOMB]).map(n=>new Promise(res=>{const i=new Image();i.onload=()=>{CACHE[n]=i;res();};i.src="images/"+n;})));dlog("preload done");}
  function makeFruit(name){const el=document.createElement("div");el.className="fruit";const img=document.createElement("img");img.className="fruit-img";img.src=CACHE[name]?CACHE[name].src:"images/"+name;const iw=100+(Math.random()*20);img.style.width=iw+"px";el.style.width=iw+"px";el.appendChild(img);gameArea.appendChild(el);return el;}
  function spawnFruit(){if(!running)return;if(active.length>=MAX_ACTIVE)return;const n=Math.random()<.9?IMAGES[Math.floor(Math.random()*IMAGES.length)]:BOMB;const el=makeFruit(n);const x=Math.random()*(areaW-100),y=-150;const vx=(Math.random()-.5)*4,vy=15+Math.random()*3;active.push({el,x,y,vx,vy,type:n});}
  function step(){for(let i=active.length-1;i>=0;i--){const f=active[i];f.vy-=GRAVITY;f.x+=f.vx;f.y+=f.vy;f.el.style.transform=`translate(${f.x}px,${-f.y}px)`;if(f.y<-400||f.x<-200||f.x>areaW+200){f.el.remove();active.splice(i,1);}}drawBlade();requestAnimationFrame(step);}requestAnimationFrame(step);
  let isDown=false,bladePoints=[];function addBlade(x,y){const r=gameArea.getBoundingClientRect();bladePoints.push({x:x-r.left,y:y-r.top,t:Date.now()});if(bladePoints.length>12)bladePoints.shift();}
  function drawBlade(){bladeCtx.clearRect(0,0,bladeCanvas.width,bladeCanvas.height);for(let i=0;i<bladePoints.length-1;i++){const a=bladePoints[i],b=bladePoints[i+1];const alpha=Math.max(0,1-(Date.now()-a.t)/350);bladeCtx.strokeStyle=`rgba(34,197,94,${alpha})`;bladeCtx.lineWidth=8*alpha;bladeCtx.beginPath();bladeCtx.moveTo(a.x,a.y);bladeCtx.lineTo(b.x,b.y);bladeCtx.stroke();}}
  window.addEventListener("pointerdown",e=>{isDown=true;addBlade(e.clientX,e.clientY);});
  window.addEventListener("pointermove",e=>{if(!isDown)return;addBlade(e.clientX,e.clientY);checkHits(e);});
  window.addEventListener("pointerup",()=>{isDown=false;bladePoints=[];});
  function checkHits(e){const p={x:e.clientX,y:e.clientY};for(const f of [...active]){const r=f.el.getBoundingClientRect();if(p.x>r.left&&p.x<r.right&&p.y>r.top&&p.y<r.bottom){cutFruit(f);}}}
  function cutFruit(f){if(f.cut)return;f.cut=true;f.el.remove();active.splice(active.indexOf(f),1);if(f.type===BOMB){lives--;if(lives<=0)gameOver();updateHUD();return;}score+=10;coins+=2;updateHUD();}
  function updateHUD(){scoreEl.textContent=score;livesEl.textContent=lives;coinsEl.textContent=coins;levelEl.textContent=level;}
  function startGame(){if(running)return;running=true;bigStart.style.display="none";spawnFruit();spawnTimer=setInterval(spawnFruit,SPAWN_BASE);updateHUD();}
  function pauseGame(){running=!running;if(!running){clearInterval(spawnTimer);}else{spawnTimer=setInterval(spawnFruit,SPAWN_BASE);}updateHUD();}
  function restartGame(){for(const f of [...active])f.el.remove();active.length=0;score=0;lives=3;coins=0;level=1;running=false;clearInterval(spawnTimer);bigStart.style.display="block";updateHUD();}
  function gameOver(){running=false;clearInterval(spawnTimer);bigStart.style.display="block";}
  startBtn.onclick=startGame;pauseBtn.onclick=pauseGame;restartBtn.onclick=restartGame;bigStart.onclick=startGame;
  (async()=>{await preload();resizeAll();restoreState();setTimeout(()=>startGame(),500);})();
  function saveState(){localStorage.setItem("fruitcut_state",JSON.stringify({score,coins,lives}));}
  function restoreState(){const s=JSON.parse(localStorage.getItem("fruitcut_state")||"{}");if(s.score)score=s.score;if(s.coins)coins=s.coins;if(s.lives)lives=s.lives;updateHUD();}
  window.addEventListener("beforeunload",saveState);
})();
</script>
</body>
  </html>
